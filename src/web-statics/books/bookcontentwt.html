<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>嗖</title>  
<link href="../bootstrap/5.1.1/bootstrap.min.css" rel="stylesheet">
<script src="../bootstrap/5.1.1/bootstrap.bundle.min.js"></script> 
<script src="../js/vue.global.js"></script>
<script src="../js/axios.min.js"></script>
<link href="css_book.css" rel="stylesheet"> 
<script src="js_book.js"></script>
</head>
<body>
<div id = "app" class="row"  @mousedown="clearSel" > 
	  
 <div id = 'msg' class="tx_msg">鼠标显示菜单:(X:{{xpoint}} ,Y:{{ypoint}})</div>
 
<div class="bk_oneframe" @mousedown="clearSel" style="background-color: aliceblue;">
	 
        <div  class="bk_onerow ">
               <div class="boxinner bk_content"  >
               
                <p style="height:22px;"> 
					<b>{{book.chiefAlbum}}</b></a>
                </p>
               <p style=" margin:0px;">
			    <span v-html="book.summary"></span> 
			   <p></p>
               </div>
        </div>
        
		<div class="bk_onerow" >
		 	<div class="boxinner">
				  
				<p><b>{{book.name}} </b></p>
				 
			    <div style="margin-bottom:0.93rem;" class="bk_onerow bk_onecontent"  v-for="para in paras" v-bind:id="para.gid"   >  
				      <div @onmousedown="hiddenMsg"  @mouseup="showMsg" style="margin-right: 10px;width: 40%;"   > 
						  &emsp;&emsp;{{para.content}}
					  </div> 
				      <div  @onmousedown="hiddenMsg" @mouseup="showMsg" style="margin-left:19px;width: 58%;"  > 
						  &emsp;&emsp;{{para.transcation}}
					  </div>  
			  	</div>
		  	</div>
        </div>
               
 
</div>

 
               

	<div class="fixed-btn"> 
 
		<a  class="fixed-btn-a" href="index.html"> 
		    <svg   width="25" height="25" fill="currentColor"   viewBox="0 0 16 16">
		  <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z"/>
		  <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z"/>
		</svg>
		</a>
		
		
			<a  class="fixed-btn-a"   v-bind:href="'album.html?albid='+ albid"  > 
		    <svg  width="25" height="25" fill="currentColor" viewBox="0 0 16 16">
		  <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
		</svg>
		</a>
		    
		
		
		
		<a  class="fixed-btn-a"  href="pers.html"> 
		<svg   width="25" height="25" fill="currentColor" class="bi bi-person-workspace" viewBox="0 0 16 16">
		  <path d="M4 16s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H4Zm4-5.95a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/>
		  <path d="M2 1a2 2 0 0 0-2 2v9.5A1.5 1.5 0 0 0 1.5 14h.653a5.373 5.373 0 0 1 1.066-2H1V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v9h-2.219c.554.654.89 1.373 1.066 2h.653a1.5 1.5 0 0 0 1.5-1.5V3a2 2 0 0 0-2-2H2Z"/>
		</svg>
		</a>
		
		
				<a  class="fixed-btn-a"  href="search.html"> 
		   <svg  width="30" height="30" fill="currentColor"   viewBox="0 0 16 16">
		  <path d="M3 2.5A1.5 1.5 0 0 1 4.5 1h1A1.5 1.5 0 0 1 7 2.5V5h2V2.5A1.5 1.5 0 0 
		  1 10.5 1h1A1.5 1.5 0 0 1 13 2.5v2.382a.5.5 0 0 0 .276.447l.895.447A1.5 1.5 0 0 1 15 
				  7.118V14.5a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 14.5v-3a.5.5 0 0 1 .146-.354l.854-.853V9.5a.5.5 
				  0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v.793l.854.853A.5.5 0 0 1 7 11.5v3A1.5 1.5 0 0 1 5.5 16h-3A1.5 1.5 0 0 
				  1 1 14.5V7.118a1.5 1.5 0 0 1 .83-1.342l.894-.447A.5.5 0 0 0 3 4.882V2.5zM4.5 2a.5.5 0 0 0-.5.5V3h2v-.5a.5.5 0
				   0 0-.5-.5h-1zM6 4H4v.882a1.5 1.5 0 0 1-.83 1.342l-.894.447A.5.5 0 0 0 2 7.118V13h4v-1.293l-.854-.853A.5.5 0 0 1 
				   5 10.5v-1A1.5 1.5 0 0 1 6.5 8h3A1.5 1.5 0 0 1 11 9.5v1a.5.5 0 0 1-.146.354l-.854.853V13h4V7.118a.5.5 0 0 0-.276-.447l-.895-.
				   447A1.5 1.5 0 0 1 12 4.882V4h-2v1.5a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V4zm4-1h2v-.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5V3zm4 
				  11h-4v.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5V14zm-8 0H2v.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5V14z"/>
				</svg>
				</a>
		
		</div>    
    
</div> 





   
<script>


  
const app = {
	data() {
		return { 
			 paras:[] ,
			 book:{}, 
			 targets:[],
			 paraId:0,
			 paragra:"",
			 albid:0,
			 linkTars:[],
			 target:'',
			 targetName:'',
			 tarname4Add:"",
			 dynastys:[],
			 targetdetail:"",
			 xpoint:0,
			 ypoint:0
		}
	},
	mounted () {
		const bookid = getUrlParam('bookid')
		 
		const params = {bookid:bookid}
				  
		axios.get('/selectcontents',{params:params})
		  .then(response => {
			  this.paras = response.data.reObject["paras"]
			  this.book = response.data.reObject["book"]
			  this.albid = this.book.albumId
			  document.title = this.book.chiefAlbum + "-" + this.book.name
			})
		  .catch(function (error) {  
			 showErrTips(error) 
		});
		
		
		axios.get('/selectDynasty' ,{params:params} )
		  .then(response => {
			  this.dynastys = response.data.reObject  
			})
		  .catch(function (error) {  
			 showErrTips("朝代信息：" + error) 
		});
		
		 
	} ,
	methods: {
		handleMouseDown(pid) {
			this.targetdetail = "" 
			this.linkTars  = getTargets(pid)
			 
			let byClassDivs = document.getElementsByClassName('para_sel_border')
			
			for (var i=0;i<byClassDivs.length;i++)
			{ 
			    byClassDivs[i].className = "para_border"
			}
			
			let  selDiv =  document.getElementById(pid)
			
			selDiv.className = "para_sel_border" 
			this.paraId = pid 
			
		},
		
	    handleMouseUp(pid) {
			this.targetdetail = ""
			this.linkTars  = getTargets(pid)
			
			let byClassDivs = document.getElementsByClassName('para_sel_border')
			
			for (var i=0;i<byClassDivs.length;i++)
			{ 
			    byClassDivs[i].className = "para_border"
			}
			
			let  selDiv =  document.getElementById(pid)
			
			selDiv.className = "para_sel_border"	 

			
			
	    	this.paraId = pid
	    	  
	    	
	    	
	    	
	    	 
	    },
	     hiddenMsg ()
	     {
			 var oMsg = document.getElementById("msg");
	    	oMsg.className = "tx_msg"	
		 },
	    showMsg(event)
	    {
			  
			let targetName = window.getSelection().toString()
	    	  
	    	
		 	var oMsg = document.getElementById("msg");
	    	oMsg.className = "tx_msg_show"	
	    	
	    	var e = event || window.event;
            var scrollx = document.documentElement.scrollLeft || document.body.scrollTop;
            var scrolly= document.documentElement.scrollTop || document.body.scrollTop;
            var x = e.pageX || e.clientX + scrollx;
            var y = e.pageY || e.clientY + scrolly;
 

	    	this.xpoint = x 
	    	this.ypoint = y
	    	
	    	 
	    	eleftP = x - 120
	    	etopP = y - 30
	    	 
	    	oMsg.style['left'] =  eleftP + 'px';
            oMsg.style['top'] =  etopP + 'px';
		},
	    queryTargets(){
			targetName = this.targetName 
			if(targetName==null||targetName=='')
	    	{
				this.targets = []
				return
			}
			
			
			 
			const params = {targetName:targetName}	  
			axios.get('/selectTargets',{params:params})
		  	.then(response => {
			  	this.targets = response.data.reObject   
			  	this.target = this.targets[0].id
			  	
			  	this.targetdetail = this.targets[0].details
			  	
			  	if(this.targets.length>0)
				{
					showOKTips(this.targets[0].name)
					
					var oMsg = document.getElementById("msg");
	    			oMsg.className = "tx_msg_show"	
				} 
				
				 
			})
		  	.catch(function (error) {  
			 	 
			}); 
			
			
			
			
		},
	    toSaveRelation(){
			paraId = this.paraId 
			if (paraId<=0)
			{ 
				return;
			}
			 
			const params = {targetId:this.target,paragId:this.paraId}
			 
			axios({
				method:'post',
				url:'/addlink',
				data: params				
			}).then(function(response) {
				showOKTips( "添加成功！")
			}).catch(function (error) { // 请求失败处理
				showErrTips( "添加失败！")
			});  
			
			this.linkTars  = getTargets(paraId)
		},
		clearSel(){
			 let byClassDivs = document.getElementsByClassName('para_sel_border')
			
			for (var i=0;i<byClassDivs.length;i++)
			{ 
			    byClassDivs[i].className = "para_border"
			}
			 
			this.paraId = 0
		} ,
		toAddTarget()
		{
			const params = {  
				name : this.tarname4Add,
				dynasty : this.dynasty,
				details  :this.tardetails 
			}
			 
			
             axios
			  .post('/addtarget', params)
			  .then(
			  function (response) {
				  showOKTips(params.name + "：新增成功！")
			  }  
			  )
			  .catch(function (error) { // 请求失败处理
				  showErrTips(params.name + "：新增失败！")
			});    
		},
		tarChangeed()
		{
			let  selTar =  document.getElementById("target") 
			var index = selTar.selectedIndex ;
			 
			this.targetdetail = selTar.options[index].getAttribute("data-text")
			
		}
		
	}
	 
}
 
vm = Vue.createApp(app).mount('#app')
 
</script>
 

</body>
</html>