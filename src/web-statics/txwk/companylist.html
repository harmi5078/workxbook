<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>公司管理列表</title>  
<link href="../bootstrap/5.1.1/bootstrap.min.css" rel="stylesheet">  
<script src="../bootstrap/5.1.1/bootstrap.bundle.min.js"></script>  
<script src="../js/vue.global.js"></script>
<script src="../js/axios.min.js"></script>
<script src="js_txnav.js"></script>
<script src="js_txcommon.js"></script> 
<link href="css_txworks.css" rel="stylesheet"> 

</head>
<body>

<div id="startmenu" style="z-index:88;"></div> 
<div id = "app" onmousedown="closeNav()" style="z-index: 8;"> 	
	
<div class="tx_topLev2"  > </div>
 
 
<div  id="maindiv"  class="tx_oneframe" onmousedown="closeNav()" style="font-family: 宋体; background-color: aliceblue;"> 
	<div class="tx_onerow" style="position: fixed;width: 86.5%;background-color: aliceblue;">  
	<div   class="tx_acccheckheader" style="margin-top:20px ;" >	 
			 供应商公司列表
	</div>
 
	<div class="tx_onerow "  style="font-weight: bold;width: 100%;border-top: var(--cell-boder );"  > 
		<div style="width: 20%;padding-left:8px;"><input type="text"  @change="reloadData()" v-model="comName" class="tx_acekTitleLabel" placeholder="公司名称"  > </div >	 
		<div style="width: 10%;padding-left:8px;"  class="tx_cellboder_left ">公司简称</div >	 	
		<div style="width: 40%;padding-left:8px;"  class="tx_cellboder_left ">联系信息</div >	
		<div style="width: 30%;padding-left:8px;"  class="tx_cellboder_left ">备注</div >	 
	</div>

</div >	

<div style="margin-top: 88px;">
<div class="tx_onerow tx_tab_row " style="border-top: var(--cell-boder );" v-for="(item,index) in items" v-bind:id="'tid'+item.tid">  
	<div style="width: 20%;padding-left:8px;" >  <a style="cursor: pointer;" @click="toEditcompany(item)"  data-bs-toggle="modal" data-bs-target="#myModal">{{ item.fullName }}  </a>  </div >	
	<div style="width: 10%;padding-left:8px;" class="tx_cellboder_left">  {{ item.name }} </div >	
	<div style="width: 40%;padding-left:8px;" class="tx_cellboder_left" > {{ item.contractName }} .{{ item.contractInfo }} .{{ item.contractAddr }}   </div >		 
	<div style="width: 25%;padding-left:8px;" class="tx_cellboder_left">
		
		 <!--业务持续状态-->
		 <a @click="changeOnBussiness(item)"  
			 v-if="(item.onbussiness==1)"  style="cursor: pointer;">  
			 	<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 32 32">
					 <path fill="green" stroke="green" stroke-linecap="round" stroke-linejoin="round" 
					 d="M8 9a4 4 0 1 1 4-4a4 4 0 0 1-4 4m0-6a2 2 0 1 0 2 2a2 2 0 0 0-2-2m16 6a4 4 0 1 1 4-4a4 4 0 0 1-4 4m0-6a2 2 0 1 0 2 2a2 2 0 0 0-2-2m2 27h-4a2 2 0 0 1-2-2v-7h2v7h4v-9h2v-6a1 1 0 0 0-1-1h-6.42L16 20l-4.58-8H5a1 1 0 0 0-1 1v6h2v9h4v-7h2v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7a2 2 0 0 1-2-2v-6a3 3 0 0 1 3-3h7.58L16 16l3.42-6H27a3 3 0 0 1 3 3v6a2 2 0 0 1-2 2v7a2 2 0 0 1-2 2"/></svg>
			 <a @click="changeOnBussiness(item)"  
			 v-else  style="cursor: pointer;" >  
			 	<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 32 32">
					 <path fill="gray" d="M8 9a4 4 0 1 1 4-4a4 4 0 0 1-4 4m0-6a2 2 0 1 0 2 2a2 2 0 0 0-2-2m16 6a4 4 0 1 1 4-4a4 4 0 0 1-4 4m0-6a2 2 0 1 0 2 2a2 2 0 0 0-2-2m2 27h-4a2 2 0 0 1-2-2v-7h2v7h4v-9h2v-6a1 1 0 0 0-1-1h-6.42L16 20l-4.58-8H5a1 1 0 0 0-1 1v6h2v9h4v-7h2v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7a2 2 0 0 1-2-2v-6a3 3 0 0 1 3-3h7.58L16 16l3.42-6H27a3 3 0 0 1 3 3v6a2 2 0 0 1-2 2v7a2 2 0 0 1-2 2"/></svg>
			 	
			 	 </a> 
			 
			 <!--可开票退税--> 
			 <a @click="changeOnRetax(item)"  
			 v-if="(item.retax==1)"  style="cursor: pointer;">  
			 	<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 14 14">
					 <g fill="green" stroke="green" stroke-linecap="round" stroke-linejoin="round">
						 
						 <path d="M3 8H1.5a5.5 5.5 0 0 0 11 0H11"/>
						 <circle cx="7" cy="2" r="1.8"/>
						 <path d="M7 3.5v10m-1.5-7h3"/>
						 </g>
						 
						 </svg>
				 	
				 <a @click="changeOnRetax(item)"  
			 v-else  style="cursor: pointer;" >  
			 	 	<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 14 14"><g fill="none" stroke="gray" stroke-linecap="round" stroke-linejoin="round"><path d="M3 8H1.5a5.5 5.5 0 0 0 11 0H11"/><circle cx="7" cy="2" r="1.5"/><path d="M7 3.5v10m-1.5-7h3"/></g></svg>
			 	 
			 	 	 </a> 
			 
			  {{ item.remark }}
	</div >  
	      
</div>    
</div>
 
</div>

<div class="tx_leftbtn" @click="toAddNew(item)"  data-bs-toggle="modal" data-bs-target="#myModal">
	<a >
 <svg xmlns="http://www.w3.org/2000/svg" width="36" height="26" fill="white"  viewBox="0 0 16 16">
  <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5z"/>
  <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
</svg>
</a>
</div> 
   
<!-- 模态框 \/ -->
<div class="modal" id="myModal">
  <div class="modal-dialog tx_modal_dlg">
    <div class="modal-content">

      <!-- 模态框头部 -->
      <div class="tx_modal_header">
        <h4 class="modal-title">{{modelTitle}}</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- 模态框内容 -->
      <div class="modal-body" >
		
        <div class="container mt-3">
 
			<form  class="needs-validation">
				<input type="hidden" v-model="isedit"   class="form-control" >
				<input type="hidden" v-model="companyId"   class="form-control" >
				
				<div class="tx_onerow">
				
					<div class="input-group " style="width: 49%;margin-bottom:0.2rem">
						<span class="input-group-text">公司简称</span>
						<input type="text" v-model="name"   class="form-control" placeholder="公司简称" required>
					</div>  
					
					<div class="input-group tx_mb_2"  style="width: 49%;margin-left:0.7rem">
						<span class="input-group-text">公司类型</span>
						<select class="form-select tx_input_font" v-model="type"   >
							<option  value="1">工厂 </option>
							<option  value="2">货代 </option>
							<option  value="3">服务商 </option>
						</select> 
					</div> 
				
				</div> 
				<div class="input-group tx_mb_2"  style="margin-bottom:0.2rem">
						<span class="input-group-text">公司全名</span>
						<input type="text" v-model="fullName"  class="form-control" placeholder="公司全名">
					</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">所属国家</span>
					<input type="text" v-model="nation"  class="form-control" placeholder="公司注册国家">
				</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">公司地址</span>
					<input type="text" v-model="addr"  class="form-control" placeholder="公司注册地址">
				</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">联系姓名</span>
					<input type="text" v-model="contractName"  class="form-control" placeholder="公司主要的联系人">
				</div> 
				 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">联系信息</span>
					<input type="text" v-model="contractInfo"  class="form-control" placeholder="手机或者微信">
				</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">备注</span>
					<input type="text" v-model="remark"  class="form-control" placeholder="备注">
				</div>				
			</form>
		</div>
		<!-- 模态框底部 -->
		<div class="modal-footer"> 
			<button type="button" class="btn btn-danger" data-bs-dismiss="modal">关闭</button>
			<button type="button" @click="toSavecompany" data-bs-dismiss="modal"  class="btn btn-primary" >保存</button>
		</div>	
      </div>
    </div>
  </div>
  
</div>
<!-- /\ modal -->


</div>
 
<script>
 	
const app = {

	data() {
		return {
		  items : [] ,	 
		  startmenuHtml : getStartMenuHtml_fb() ,  
		  modelTitle : '新增公司',
		  companyId : '',
		  name: '',
		  type:1,
		  fullName: '',
		  nation: '',
		  addr: '',
		  contractName: '',
		  contractAddr: '',
		  contractInfo: '',
		  remark: '',
		  isedit: false	 ,
		  comName:'' 
		}
	},
	mounted () {
		this.reloadData()
	},
	methods: { 
		toAddNew(event)
		{ 
			this.isedit = false
			this.modelTitle = "新增公司" 
			this.name = ""
			this.fullName = ""
			this.nation = ""
			this.addr = ""
			this.contractName = ""
			this.contractAddr = ""
			this.contractInfo = ""
			this.remark = "" 
			this.companyId = ""
		},	  
		reloadData(event) { 
			
			const params = {   
				fullName:this.comName
		 	}	
		 
			  axios
			  .get('/getcomplist',{params:params})
			  .then(response => (this.items = response.data.reObject))
			  .catch(function (error) { // 请求失败处理
				showErrTips("数据加载失败：" + error) 
			});
		} ,
		
		toSavecompany(event){
			
			const params = { 
				  id: this.companyId,
				  name: this.name,
				  fullName: this.fullName,
				  nation: this.nation,
				  addr: this.addr,
				  contractName: this.contractName,
				  contractAddr: this.contractAddr,
				  contractInfo: this.contractInfo,
				  remark: this.remark,
				  type:this.type
			  }
			  
			if(!this.isedit)
			{
				this.addcompany(event,params);
			}
			else
			{ 
				this.savecompany(event,params);
			}
			 
		} ,
		
		savecompany(event,params) {
			 
             axios
			  .post('/savecompany', params )
			  .then(
			  function (response) {
				showOKTips(params.name + ":修改成功！")  	
			  }  
			  )
			  .catch(function (error) { // 请求失败处理 
				showErrTips(params.name + ":修改失败！")  
			});  
        } ,
        addcompany(event,params) {
			  			  
             axios
			  .post('/addcompany', params )
			  .then(
			  function (response) {
				 showOKTips(params.name + "添加成功！")
			  } 
			  )
			  .catch(function (error) { // 请求失败处理
				  showErrTips(params.name + "添加失败！")
			});    
        } ,
        toEditcompany(item)
        {
			this.isedit = true
			this.modelTitle =item.name + " - 编辑" 
			this.name = item.name
			this.fullName = item.fullName
			this.nation = item.nation
			this.addr = item.addr
			this.contractName = item.contractName
			this.contractAddr = item.contractAddr
			this.contractInfo = item.contractInfo
			this.remark = item.remark 
			this.companyId = item.id
			this.type = item.type
		},
		changeOnBussiness(item)
		{
			if(item.onbussiness==1)
			{
				item.onbussiness=0
			}
			else{
				item.onbussiness=1
			}
			
			const params = { 
				  id: item.id, 
				  onbussiness:item.onbussiness
			}
			  
			axios
			  .post('/updateOnBussiness', params )
			  .then(
			  function (response) {
				 showOKTips( "更新成功！")
			  } 
			  )
			  .catch(function (error) { // 请求失败处理
				  showErrTips(  "更新失败！")
			});  
			
		},
		changeOnRetax(item)
		{
			if(item.retax==1)
			{
				item.retax=0
			}
			else{
				item.retax=1
			}
			
			const params = { 
				  id: item.id, 
				  retax:item.retax
			}
			  
			axios
			  .post('/updateretax', params )
			  .then(
			  function (response) {
				 showOKTips( "更新成功！")
			  } 
			  )
			  .catch(function (error) { // 请求失败处理
				  showErrTips(  "更新失败！")
			});  
			
		}
	}  
}
 
vm = Vue.createApp(app).mount('#app')
 
</script>
 

</body>
</html>