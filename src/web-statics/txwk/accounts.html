<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>账户管理</title>  
<link href="../bootstrap/5.1.1/bootstrap.min.css" rel="stylesheet">  
<script src="../bootstrap/5.1.1/bootstrap.bundle.min.js"></script>  
<script src="../js/vue.global.js"></script>
<script src="../js/axios.min.js"></script>
<script src="js_txnav.js"></script>
<script src="js_txcommon.js"></script> 
<link href="css_txworks.css" rel="stylesheet"> 
</head>
<body>
	
<div id="startmenu" style="z-index:88;"></div> 
<div id = "app" onmousedown="closeNav()" style="z-index: 8;"> 	
	
<div class="tx_topLev2"  > </div>	
 
  
<div  class="tx_oneframe" style="font-family: 宋体; background-color: aliceblue;">   

<div class="tx_onerow" style="position: fixed;width: 86.5%;background-color: aliceblue;">  
	<div   class="tx_acccheckheader" style="margin-top:20px ;" >	 
			 公司账户列表
	</div>
 
	<div class="tx_onerow "  style="font-weight: bold;width: 100%;border-top: var(--cell-boder );"  > 
		<div style="width: 8%;padding-left:8px;"><input type="text"  @change="reloadData()" v-model="comName" class="tx_acekTitleLabel" placeholder="公司"  > </div >	 
		<div style="width: 18%;padding-left:8px;"  class="tx_cellboder_left ">账户名称</div >	
		<div style="width: 8%;padding-left:8px;"  class="tx_cellboder_left ">别称</div > 
		<div style="width: 18%;padding-left:8px;"  class="tx_cellboder_left ">账号</div > 	
		<div style="width: 22%;padding-left:8px;"  class="tx_cellboder_left ">开户行</div >	 
		<div style="width: 16%;padding-left:8px;"  class="tx_cellboder_left ">备注</div >
	</div>

</div >	

<div style="margin-top: 88px;">
<div class="tx_onerow tx_tab_row " style="border-top: var(--cell-boder );" v-for="(item,index) in items" v-bind:id="'tid'+item.tid">  
	<div style="width: 8%;padding-left:8px;" >  <a style="cursor: pointer;" @click="toEditAcc(item)"
				  data-bs-toggle="modal" data-bs-target="#myModal">{{ item.companyName  }}  </a>  </div >	
	<div style="width: 18%;padding-left:8px;" class="tx_cellboder_left">  {{ item.accName }} </div >	
	<div style="width: 8%;padding-left:8px;" class="tx_cellboder_left">  {{ item.alias }} </div >		 
	<div style="width: 18%;padding-left:8px;" class="tx_cellboder_left">{{ item.accNo }}</div >  
	<div style="width: 22%;padding-left:8px;" class="tx_cellboder_left"> {{ item.bank }} </div > 
	<div style="width: 16%;padding-left:8px;" class="tx_cellboder_left"> 
		
		 <a @click="changeIsPayment(item)"  
			 v-if="(item.isPayment==1)"  style="cursor: pointer;">  
			 	支付账户.   
			 </a> 
			 
			 <a @click="changeIsPayment(item)"  
			 v-else  style="cursor: pointer;" >  
			 	 暂无支付. 
			 </a> 
		
		
		
		{{ item.remark }} 
		
	</div >    
</div>    
</div>

 

 
	 
</div>

<div class="tx_leftbtn" @click="toAddNew(item)"  data-bs-toggle="modal" data-bs-target="#myModal">
	<a >
 <svg xmlns="http://www.w3.org/2000/svg" width="36" height="26" fill="white"  viewBox="0 0 16 16">
  <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5z"/>
  <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
</svg>
</a>
</div>  
   
<!-- 模态框 -->
<div class="modal" id="myModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <!-- 模态框头部 -->
      <div class="tx_modal_header">
        <h4 class="modal-title">{{modelTitle}}</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- 模态框内容 -->
      <div class="modal-body">
        <div class="container mt-3">
 
			<form  class="needs-validation">
				<input type="hidden" v-model="isedit"   class="form-control" >
				<input type="hidden" v-model="accId"   class="form-control" >
				<div class="input-group " style="margin-bottom:0.2rem">
					<span class="input-group-text">所属公司</span>
					<select class="form-select" v-model="company">
						<option v-for="com  in companys" :value="com.id">
						  {{ com.fullName }}
						</option>
					</select>
				</div> 
				 
				<div class="input-group tx_mb_2">
					<span class="input-group-text">账户姓名</span>
					<input type="text" v-model="accName"  class="form-control" placeholder="账户姓名">
				</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">账号信息</span>
					<input type="text" v-model="accNo"  class="form-control" placeholder="账号信息">
				</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">开户银行</span>
					<input type="text" v-model="bank"  class="form-control" placeholder="开户银行">
				</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text">公账私账</span>
					<select class="form-select" v-model="isCompany"> 
						<option value="1">公账</option>
						<option value="0">私账</option>
					</select> 
				</div> 
				
				<div class="input-group tx_mb_2">
					<span class="input-group-text"> 账户别名</span>
					<input type="text" v-model="alias"  class="form-control" placeholder="账户别名">
				</div> 
				 
				<div class="input-group tx_mb_2">
					<span class="input-group-text">备注</span>
					<input type="text" v-model="remark"  class="form-control" placeholder="备注">
				</div>

				<!-- 模态框底部 -->
			  	<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-bs-dismiss="modal">关闭</button>
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal" @click="toSaveAccount" >保存</button>
			  </div>				
			</form>
		</div>
      </div>
    </div>
  </div>
</div>
</div>

</div>

 
<script>
const app = {
	data() {
		return {
		  items : [] ,	 
		  startmenuHtml : getStartMenuHtml_fb() , 
		  modelTitle : '新增账号',
		  company : '',
		  accName: '',
		  accNo: '',
		  bank: '',
		  isCompany: '',
		  status: '', 
		  remark: '',
		  alias:'',
		  companys: [
					{ name: '泰湘', id: 1 },
					{ name: '维卡', id: 2 } 
				  ]	,
		  isedit: false	  
		}
	},
	mounted () {
		axios.get('/getcomplist')
		  .then(response => (this.companys = response.data.reObject))
		  .catch(function (error) {  
			this.companys = [{ name: '泰湘', id: 1 },
				{ name: '维卡', id: 2 }   ]	  ;
		});
		this.reloadData()
	},
	methods: { 
		  
		reloadData(event) { 
			  axios
			  .get('/getaccounts')
			  .then(response => (this.items = response.data.reObject))
			  .catch(function (error) { // 请求失败处理
				 
			});
		} ,
		
		toSaveAccount(event){
			const params = { 
				accId: this.accId,
				companyId: this.company,
				accName:this.accName,
				accNo: this.accNo,
				bank: this.bank,
				addr: this.addr,
				isCompany: this.isCompany,
				status: this.status, 
				remark: this.remark,
				alias:this.alias
			}
			 
			if(!this.isedit)
			{
				this.addAccount(event,params);
			}
			else
			{ 
				this.saveAccount(event,params);
			}
			
		} ,
		
		saveAccount(event,params) {
			
             axios
			  .post('/saveaccount', params)
			  .then(
			  function (response) {
				  
			  }  
			  )
			  .catch(function (error) { // 请求失败处理
				  
			});   
			 
        } ,
        addAccount(event,params) {
			
             axios
			  .post('/addaccount', params)
			  .then(
			  function (response) {
				 
			  } 
			  
			  )
			  .catch(function (error) { // 请求失败处理
				  
			});    
        } ,
		
        toEditAcc(item)
        { 
			this.isedit = true
			this.modelTitle =item.accName + " - 编辑" 
			this.company = item.companyId
			this.accName = item.accName
			this.accNo = item.accNo
			this.isCompany = item.isCompany
			this.status = item.status
			this.remark = item.remark
			this.bank = item.bank
			this.remark = item.remark 
			this.accId = item.accId 
			this.alias = item.alias
		},
		changeIsPayment(item)
		{
			if(item.isPayment==1)
			{
				item.isPayment=0
			}
			else{
				item.isPayment=1
			}
			
			const params = { 
				  accId: item.accId, 
				  isPayment:item.isPayment
			}
			  
			axios
			  .post('/updateIsPayment', params )
			  .then(
			  function (response) {
				 showOKTips( "更新成功！")
			  } 
			  )
			  .catch(function (error) { // 请求失败处理
				  showErrTips(  "更新失败！")
			});  
		}
		
	  }  
}
 
vm = Vue.createApp(app).mount('#app')
 
</script>
 
</body>
</html>